<?php

namespace App\Http\Controllers;

use App\Models\Ari;
use App\Models\Rit;
use App\Models\AriSampling;
use Illuminate\Http\Request;

class FindAriController extends Controller
{
    public function index(){
        $rit_id = self::getRitId();
        $sampling_id = self::getSamplingId($rit_id);
        $ari = Ari::whereIn("ari_sampling_id", $sampling_id)->select(["ari_sampling_id", "yield"])->get();
        for($i = 0; $i < count($ari); $i++){
            $ari[$i]["barcode_antrian"] = AriSampling::whereId($ari[$i]["ari_sampling_id"])->get()->last()->rit->barcode_antrian;
        }
        $data["jumlah"] = count($ari);
        $data["rendemen"] = $ari;

        return $data;
    }

    public static function getRitId(){
        return Rit::whereIn("spta", [
            "07301766",
            "07311376",
            "07300440",
            "07310063",
            "07310443",
            "07301510",
            "07300596",
            "07301916",
            "07311852",
            "07311817",
            "07300987",
            "07310293",
            "08011714",
            "08011670",
            "07311252",
            "08011771",
            "08011659",
            "08010319",
            "08011561",
            "08011811",
            "08021597",
            "08020098",
            "08020492",
            "08021429",
            "08021791",
            "08020702",
            "08021611",
            "08020491",
            "08020664",
            "08010754",
            "08020784",
            "08020770",
            "08021827",
            "08021802",
            "08031289",
            "08030919",
            "08030517",
            "08031416",
            "08031422",
            "08030540",
            "08011923",
            "08030703",
            "08030653",
            "08030643",
            "08031074",
            "08041568",
            "08030400",
            "08041738",
            "08041454",
            "08040835",
            "08040186",
            "08041656",
            "08041187",
            "08040274",
            "08040328",
            "08040273",
            "08041676",
            "08041426",
            "08040530",
            "08041789",
            "08041429",
            "08040476",
            "08041695",
            "08041411",
            "08050761",
            "08051751",
            "08050221",
            "08041281",
            "08050253",
            "08051293",
            "08050419",
            "08050383",
            "08051166",
            "08051233",
            "08051664",
            "08051079",
            "08061107",
            "08061223",
            "08050923",
            "08050194",
            "08050134",
            "08060863",
            "08050316",
            "08050401",
            "08061563",
            "08060857",
            "08060864",
            "08061208",
            "08061207",
            "08061620",
            "08061680",
            "08060300",
            "08060600",
            "08060495",
            "08060557",
            "08061351",
            "08061492",
            "08070141",
            "08071060",
            "08070670",
            "08070729",
            "08061871",
            "08071069",
            "08061775",
            "08071626",
            "08060481",
            "08071163",
            "08071366",
            "08070835",
            "08070399",
            "08070310",
            "08070966",
            "08080144",
            "08080950",
            "08081526",
            "08081670",
            "08081276",
            "08081144",
            "08080438",
            "08080604",
            "08080086",
            "08080559",
            "08080609",
            "08081821",
            "08091157",
            "08080328",
            "08090895",
            "08081824",
            "08091488",
            "08090004",
            "08091760",
            "08111778",
            "08101671",
            "08100463",
            "08101189",
            "08100302",
            "08100276",
            "08111167",
            "08100548",
            "08101741",
            "08100240",
            "08111509",
            "08111638",
            "08111636",
            "08111525",
            "08111654",
            "08111867",
            "08110825",
            "08121074",
            "08120159",
            "08111873",
            "08111328",
            "08121039",
            "08121775",
            "08121793",
            "08120067",
            "08131148",
            "08121715",
            "08131617",
            "08130746",
            "08131320",
            "08130074",
            "08141583",
            "08131704",
            "08131000",
            "08131756",
            "08130289",
            "08130398",
            "08131777",
            "08131560",
            "08131815",
            "08140624",
            "08141178",
            "08141852",
            "08141151",
            "08141277",
            "08141811",
            "08140892",
            "08140692",
            "08141371",
            "08141303",
            "08150543",
            "08141188",
            "08141842",
            "08151888",
            "08151325",
            "08151174",
            "08151846"
        ])->select(["id"])->get();
    }

    public static function getSamplingId($rit_id){
        return AriSampling::whereIn("rit_id", $rit_id)->select(["id"])->get();
    }
}
